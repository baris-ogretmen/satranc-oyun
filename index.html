<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2563EB">
    <title>BarÄ±ÅŸ Ã–ÄŸretmen SatranÃ§ AtÃ¶lyesi | DeÄŸiÅŸim Koleji</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- Chessboard.js -->
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Marked -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700&display=swap');
        body { font-family: 'Nunito', sans-serif; background-color: #F0F9FF; overscroll-behavior: none; user-select: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; height: 100dvh; }
        h1, h2, h3, .brand-font { font-family: 'Fredoka', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.6); }
        .board-container { touch-action: none; margin: 0 auto; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.2); }
        #drawing-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; pointer-events: none; }
        .drawing-active { pointer-events: auto !important; cursor: crosshair; background: rgba(0,0,0,0.05); }
        .pop-in { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        /* Robot Animation */
        .robot-container { position: fixed; bottom: 100px; right: 20px; z-index: 50; cursor: pointer; animation: floatRobot 4s ease-in-out infinite; }
        @keyframes floatRobot { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .robot-body { width: 60px; height: 70px; background: linear-gradient(135deg, #3B82F6, #2563EB); border-radius: 20px; border: 3px solid white; box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4); position: relative; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .robot-container:hover .robot-body { transform: scale(1.1); box-shadow: 0 0 30px rgba(37, 99, 235, 0.6); }
        .robot-face { width: 45px; height: 35px; background: #1E293B; border-radius: 12px; position: relative; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .robot-eye { width: 8px; height: 8px; background: #60A5FA; border-radius: 50%; animation: blink 4s infinite; box-shadow: 0 0 5px #60A5FA; }
        @keyframes blink { 0%, 96%, 100% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }
        .robot-antenna { width: 4px; height: 15px; background: #64748B; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); z-index: -1; }
        .robot-ball { width: 10px; height: 10px; background: #EF4444; border-radius: 50%; position: absolute; top: -18px; left: 50%; transform: translateX(-50%); animation: antennaGlow 2s infinite; border: 2px solid white; }
        @keyframes antennaGlow { 0%, 100% { background: #EF4444; box-shadow: 0 0 0 rgba(239, 68, 68, 0); } 50% { background: #FCA5A5; box-shadow: 0 0 15px rgba(239, 68, 68, 0.8); } }
        .robot-speech { position: absolute; right: 70px; top: 10px; background: white; padding: 6px 12px; border-radius: 12px 12px 0 12px; font-size: 11px; font-weight: bold; color: #2563EB; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: max-content; text-align: right; pointer-events: none; animation: popIn 0.5s 1s backwards; }

        .gold-pulse { animation: goldPulse 1.5s infinite; }
        @keyframes goldPulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); } }
        .chat-slide-in { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .active-tab { color: #2563EB; border-top: 3px solid #2563EB; background: linear-gradient(to bottom, #eff6ff, transparent); }
        .inactive-tab { color: #9CA3AF; border-top: 3px solid transparent; }
        .chat-message { max-width: 85%; border-radius: 16px; padding: 12px; margin-bottom: 8px; font-size: 0.95rem; line-height: 1.4; }
        .chat-user { background-color: #DBEAFE; color: #1E40AF; align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-bot { background-color: #ffffff; color: #374151; align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid #E5E7EB; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .memory-card { perspective: 1000px; }
        .memory-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .memory-card.flipped .memory-card-inner { transform: rotateY(180deg); }
        .memory-card-front, .memory-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 0.5rem; }
        .memory-card-front { background-color: #2563EB; color: white; z-index: 2; }
        .memory-card-back { background-color: white; color: #1F2937; border: 2px solid #2563EB; transform: rotateY(180deg); z-index: 1; }
        .xox-cell { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: bold; background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); cursor: pointer; transition: all 0.2s; }
        .xox-cell:active { transform: scale(0.95); }
        .rank-badge { background: linear-gradient(90deg, #4F46E5, #EC4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        .fade-text { animation: fadeInOut 6s infinite; }
        @keyframes fadeInOut { 0%, 100% { opacity: 0; transform: translateY(10px); } 10%, 90% { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col overflow-hidden bg-gradient-to-br from-blue-50 to-indigo-100">

    <!-- CANVAS FOR SMART BOARD -->
    <canvas id="drawing-canvas"></canvas>

    <!-- TEACHER TOOLS -->
    <div class="fixed bottom-24 left-4 z-50 flex flex-col gap-2">
        <button onclick="toolsManager.toggleDrawing()" id="btn-draw" class="bg-white text-gray-600 w-12 h-12 rounded-full shadow-lg border border-gray-200 flex items-center justify-center hover:bg-red-50 hover:text-red-600 transition"><i class="fa-solid fa-pen"></i></button>
        <button onclick="toolsManager.toggleFullscreen()" class="bg-white text-gray-600 w-12 h-12 rounded-full shadow-lg border border-gray-200 flex items-center justify-center hover:bg-blue-50 hover:text-blue-600 transition"><i class="fa-solid fa-expand"></i></button>
    </div>

    <!-- LOGIN OVERLAY -->
    <div id="login-overlay" class="fixed inset-0 z-[60] bg-blue-600 flex flex-col items-center justify-center p-6 text-white transition-opacity duration-500">
        <div class="bg-white text-gray-800 rounded-3xl p-8 w-full max-w-sm shadow-2xl text-center">
            <!-- SCHOOL LOGO -->
             <div class="w-24 h-24 bg-white rounded-full mx-auto mb-4 flex items-center justify-center p-2 shadow-inner">
                <img src="https://cdn-icons-png.flaticon.com/512/3208/3208899.png" class="w-full h-full object-contain animate-bounce" alt="DeÄŸiÅŸim Koleji">
             </div>
            <h1 class="text-2xl font-bold mb-1 brand-font text-blue-700">DeÄŸiÅŸim Koleji</h1>
            <p class="text-sm text-gray-500 mb-6">BarÄ±ÅŸ Ã–ÄŸretmen SatranÃ§ AtÃ¶lyesi</p>
            <div class="space-y-4">
                <div class="text-left"><label class="text-xs font-bold text-gray-500 ml-1">AdÄ±n SoyadÄ±n</label><input type="text" id="login-name" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition" placeholder="Ã–rn: Ahmet YÄ±lmaz"></div>
                <div class="text-left"><label class="text-xs font-bold text-gray-500 ml-1">Åifre</label><input type="password" id="login-pass" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition" placeholder="Åifren"></div>
                <button onclick="app.login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 transition transform active:scale-95">GiriÅŸ Yap</button>
            </div>
            <p class="text-xs text-gray-400 mt-4">Ä°pucu: Åifre Ã¶ÄŸretmeninin adÄ± (barÄ±ÅŸ) ;)</p>
        </div>
    </div>

    <!-- TOP HEADER -->
    <header class="bg-blue-600/95 backdrop-blur-md text-white p-4 shadow-lg flex justify-between items-center z-20 shrink-0 sticky top-0">
        <div class="flex items-center gap-2">
             <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"><i class="fa-solid fa-chess-rook"></i></div>
             <div><h1 class="text-lg font-bold leading-tight brand-font">BarÄ±ÅŸ Ã–ÄŸretmen</h1><p class="text-blue-100 text-xs font-semibold">SatranÃ§ AtÃ¶lyesi</p></div>
        </div>
        <div class="bg-blue-800/60 px-4 py-1.5 rounded-full flex items-center gap-2 border border-blue-400/50 shadow-inner">
            <i class="fa-solid fa-coins text-yellow-400 text-lg drop-shadow-sm animate-pulse"></i><span id="gold-display" class="font-bold text-lg font-mono text-yellow-100 tracking-wider">0</span>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main id="main-container" class="flex-1 overflow-y-auto no-scrollbar relative">
        
        <!-- HOME -->
        <div id="view-home" class="view-section p-6 flex flex-col gap-4 h-full">
            <!-- WELCOME CARD -->
            <div class="glass p-6 rounded-3xl shadow-sm text-center mb-2 mt-2 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-blue-100 rounded-full -mr-10 -mt-10 opacity-50"></div>
                <div class="relative w-24 h-24 mx-auto mb-3">
                    <div class="absolute inset-0 bg-blue-400 rounded-full opacity-20 animate-ping"></div>
                    <img id="user-avatar" src="https://cdn-icons-png.flaticon.com/512/4359/4359868.png" class="w-24 h-24 rounded-full object-contain relative z-10 drop-shadow-lg" alt="Avatar">
                </div>
                <h2 class="text-2xl text-gray-800 font-bold mb-1 brand-font">HoÅŸgeldin <span id="display-name" class="text-blue-600">Åampiyon</span>!</h2>
                <div class="bg-white border-2 border-blue-100 shadow-md px-6 py-3 rounded-2xl inline-flex items-center gap-2 mb-1 mt-2 transform hover:scale-105 transition">
                    <i class="fa-solid fa-medal text-yellow-500 text-2xl drop-shadow-sm"></i>
                    <span class="font-black text-xl uppercase tracking-wider rank-badge" id="user-rank">ACEMÄ°</span>
                </div>
            </div>

            <!-- ROTATING QUOTES -->
            <div class="bg-white border-l-8 border-indigo-500 p-4 rounded-r-2xl shadow-md relative overflow-hidden mb-2">
                <h3 class="font-bold text-indigo-400 text-[10px] uppercase tracking-widest mb-1"><i class="fa-solid fa-quote-left mr-1"></i>SatranÃ§ BilgeliÄŸi</h3>
                <p id="rotating-quote" class="text-sm text-gray-800 font-bold italic min-h-[3rem] flex items-center leading-snug">SatranÃ§ zihnin jimnastiÄŸidir.</p>
            </div>

            <!-- LEADERBOARD -->
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white p-3 rounded-2xl shadow-sm border-l-4 border-yellow-400">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">En Ã‡ok Kazananlar</h3>
                    <div id="leaderboard-wins" class="text-sm font-bold text-gray-700 min-h-[40px] text-xs">YÃ¼kleniyor...</div>
                </div>
                <div class="bg-white p-3 rounded-2xl shadow-sm border-l-4 border-blue-400">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">En Ã‡ok Girenler</h3>
                    <div id="leaderboard-logins" class="text-sm font-bold text-gray-700 min-h-[40px] text-xs">YÃ¼kleniyor...</div>
                </div>
            </div>

            <!-- MENU GRID -->
            <div class="grid grid-cols-2 gap-4 pb-32">
                <button onclick="app.navTo('arena')" class="bg-white hover:bg-orange-50 border-b-4 border-orange-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-chess-knight text-3xl text-orange-600"></i><span class="font-bold text-gray-700">Oyna</span></button>
                <button onclick="app.navTo('lessons')" class="bg-white hover:bg-blue-50 border-b-4 border-blue-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-graduation-cap text-3xl text-blue-600"></i><span class="font-bold text-gray-700">Dersler</span></button>
                <button onclick="app.navTo('games_hub')" class="bg-white hover:bg-purple-50 border-b-4 border-purple-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-brain text-3xl text-purple-600"></i><span class="font-bold text-gray-700">AkÄ±l OyunlarÄ±</span></button>
                <button onclick="app.navTo('stories')" class="bg-white hover:bg-teal-50 border-b-4 border-teal-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-star text-3xl text-teal-600"></i><span class="font-bold text-gray-700">Efsaneler</span></button>
                <button onclick="app.navTo('tournaments')" class="bg-white hover:bg-red-50 border-b-4 border-red-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-trophy text-3xl text-red-600"></i><span class="font-bold text-gray-700">Turnuvalar</span></button>
                <button onclick="app.navTo('cinema')" class="bg-white hover:bg-pink-50 border-b-4 border-pink-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-film text-3xl text-pink-600"></i><span class="font-bold text-gray-700">Sinema</span></button>
                <button onclick="app.navTo('market')" class="bg-white hover:bg-emerald-50 border-b-4 border-emerald-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-store text-3xl text-emerald-600"></i><span class="font-bold text-gray-700">MaÄŸaza</span></button>
                <button onclick="app.navTo('settings')" class="bg-white hover:bg-gray-50 border-b-4 border-gray-500 p-4 rounded-2xl shadow-sm transition transform active:scale-95 flex flex-col items-center gap-2 h-28 justify-center group"><i class="fa-solid fa-gear text-3xl text-gray-600"></i><span class="font-bold text-gray-700">Ayarlar</span></button>
            </div>
        </div>

        <!-- STORIES -->
        <div id="view-stories" class="view-section hidden p-4 h-full flex flex-col overflow-y-auto">
            <h2 class="text-2xl font-bold text-teal-600 mb-4 brand-font"><i class="fa-solid fa-star mr-2"></i>BaÅŸarÄ± Hikayeleri</h2>
            <div class="space-y-4 pb-32">
                <div class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-red-500 flex flex-col gap-2">
                    <div class="flex items-center gap-3"><div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-2xl shadow-sm">ğŸ‡¹ğŸ‡·</div><div><h3 class="font-bold text-gray-800 text-lg">Ediz GÃ¼rel</h3><p class="text-xs text-gray-500 font-bold">GenÃ§ BÃ¼yÃ¼kusta (GM)</p></div></div>
                    <p class="text-sm text-gray-700 mt-1 leading-relaxed">HenÃ¼z 15 yaÅŸÄ±nda BÃ¼yÃ¼kusta (GM) unvanÄ±nÄ± aldÄ±. DÃ¼nyanÄ±n en genÃ§ yeteneklerinden biri.</p>
                    <a href="https://tr.wikipedia.org/wiki/Ediz_G%C3%BCrel" target="_blank" class="text-teal-600 text-sm font-bold mt-1 block bg-teal-50 p-2 rounded-lg text-center hover:bg-teal-100">Biyografisini Oku</a>
                </div>
                <div class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-red-500 flex flex-col gap-2">
                    <div class="flex items-center gap-3"><div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-2xl shadow-sm">ğŸ‡¹ğŸ‡·</div><div><h3 class="font-bold text-gray-800 text-lg">YaÄŸÄ±z Kaan ErdoÄŸmuÅŸ</h3><p class="text-xs text-gray-500 font-bold">DÃ¼nya Rekortmeni</p></div></div>
                    <p class="text-sm text-gray-700 mt-1 leading-relaxed">12 yaÅŸÄ±nda BÃ¼yÃ¼kusta oldu! DÃ¼nyanÄ±n gelmiÅŸ geÃ§miÅŸ en genÃ§ 4. bÃ¼yÃ¼kustasÄ±.</p>
                    <a href="https://tr.wikipedia.org/wiki/Ya%C4%9F%C4%B1z_Kaan_Erdo%C4%9Fmu%C5%9F" target="_blank" class="text-teal-600 text-sm font-bold mt-1 block bg-teal-50 p-2 rounded-lg text-center hover:bg-teal-100">Biyografisini Oku</a>
                </div>
                <div class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-blue-500 flex flex-col gap-2">
                    <div class="flex items-center gap-3"><div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-2xl shadow-sm">ğŸ‡³ğŸ‡´</div><div><h3 class="font-bold text-gray-800 text-lg">Magnus Carlsen</h3><p class="text-xs text-gray-500 font-bold">DÃ¼nya Åampiyonu</p></div></div>
                    <p class="text-sm text-gray-700 mt-1 leading-relaxed">SatrancÄ±n gelmiÅŸ geÃ§miÅŸ en bÃ¼yÃ¼k oyuncularÄ±ndan biri. 5 kez DÃ¼nya Åampiyonu oldu.</p>
                    <a href="https://tr.wikipedia.org/wiki/Magnus_Carlsen" target="_blank" class="text-blue-600 text-sm font-bold mt-1 block bg-blue-50 p-2 rounded-lg text-center hover:bg-blue-100">Biyografisini Oku</a>
                </div>
                <div class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-pink-500 flex flex-col gap-2">
                    <div class="flex items-center gap-3"><div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center text-2xl shadow-sm">ğŸ‡­ğŸ‡º</div><div><h3 class="font-bold text-gray-800 text-lg">Judit PolgÃ¡r</h3><p class="text-xs text-gray-500 font-bold">SatrancÄ±n KraliÃ§esi</p></div></div>
                    <p class="text-sm text-gray-700 mt-1 leading-relaxed">Tarihin en gÃ¼Ã§lÃ¼ kadÄ±n satranÃ§ oyuncusu. Agresif stiliyle tanÄ±nÄ±r.</p>
                    <a href="https://tr.wikipedia.org/wiki/Judit_Polg%C3%A1r" target="_blank" class="text-pink-600 text-sm font-bold mt-1 block bg-pink-50 p-2 rounded-lg text-center hover:bg-pink-100">Biyografisini Oku</a>
                </div>
            </div>
            <button onclick="app.navTo('home')" class="mt-4 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold w-full shrink-0 mb-32 shadow-md">Ana MenÃ¼ye DÃ¶n</button>
        </div>

        <!-- TOURNAMENTS -->
        <div id="view-tournaments" class="view-section hidden p-4 h-full flex flex-col overflow-y-auto">
            <h2 class="text-2xl font-bold text-red-600 mb-4 brand-font"><i class="fa-solid fa-trophy mr-2"></i>Turnuva Merkezi</h2>
            
            <div class="bg-white p-5 rounded-2xl shadow-md border border-red-100 mb-6">
                <h3 class="font-bold text-gray-800 mb-2">Resmi Turnuva Takvimi</h3>
                <p class="text-sm text-gray-500 mb-4">GÃ¼ncel kayÄ±tlar ve tarihler iÃ§in resmi siteler:</p>
                <div class="flex flex-col gap-3">
                    <a href="http://istanbul.tsf.org.tr/" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-red-50 px-4 py-3 rounded-xl hover:bg-red-100 transition border border-red-200 group">
                        <span class="font-bold text-red-700">Ä°stanbul TSF</span>
                        <i class="fa-solid fa-arrow-up-right-from-square text-red-400 group-hover:text-red-600"></i>
                    </a>
                    <a href="http://beylikduzu.tsf.org.tr/" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between bg-blue-50 px-4 py-3 rounded-xl hover:bg-blue-100 transition border border-blue-200 group">
                        <span class="font-bold text-blue-700">BeylikdÃ¼zÃ¼ TSF</span>
                        <i class="fa-solid fa-arrow-up-right-from-square text-blue-400 group-hover:text-blue-600"></i>
                    </a>
                </div>
                <p class="text-[10px] text-gray-400 mt-2 italic text-center">Not: Linkler aÃ§Ä±lmazsa tarayÄ±cÄ± izinlerini kontrol ediniz.</p>
            </div>
            
            <div class="space-y-4 pb-32">
                <!-- SWISS SYSTEM INFO -->
                <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-indigo-500">
                    <h3 class="font-bold text-lg mb-2 text-gray-800 flex items-center gap-2"><i class="fa-solid fa-sitemap text-indigo-500"></i> Ä°sviÃ§re Sistemi Nedir?</h3>
                    <p class="text-sm text-gray-600 leading-relaxed mb-2">Ã‡oÄŸu satranÃ§ turnuvasÄ±nda (Ã¶zellikle kalabalÄ±k olanlarda) kullanÄ±lan sistemdir.</p>
                    <ul class="space-y-1 text-sm text-gray-600 list-disc pl-5">
                        <li>Herkes eÅŸit sayÄ±da maÃ§ yapar (Ã–rn: 6 tur).</li>
                        <li>Elenen olmaz! Kaybetsen bile oynamaya devam edersin.</li>
                        <li>Her turda, seninle aynÄ± puana sahip biriyle eÅŸleÅŸirsin.</li>
                        <li>Kazanan 1, Berabere 0.5, Kaybeden 0 puan alÄ±r.</li>
                    </ul>
                </div>

                <!-- ROUND ROBIN INFO -->
                 <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-green-500">
                    <h3 class="font-bold text-lg mb-2 text-gray-800 flex items-center gap-2"><i class="fa-solid fa-rotate text-green-500"></i> DÃ¶ner Sistem (Round Robin)</h3>
                    <p class="text-sm text-gray-600 leading-relaxed mb-2">Az sayÄ±da oyuncu varsa kullanÄ±lÄ±r (Ã–rn: 10 kiÅŸi).</p>
                    <ul class="space-y-1 text-sm text-gray-600 list-disc pl-5">
                        <li>Gruptaki <strong>herkes herkesle</strong> birer kez maÃ§ yapar.</li>
                        <li>En adil sistemdir Ã§Ã¼nkÃ¼ herkes birbiriyle karÅŸÄ±laÅŸÄ±r.</li>
                        <li>En Ã§ok puan toplayan ÅŸampiyon olur.</li>
                    </ul>
                </div>

                 <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-yellow-500">
                    <h3 class="font-bold text-lg mb-2 text-gray-800 flex items-center gap-2"><i class="fa-solid fa-id-card text-yellow-500"></i> Lisans Ä°ÅŸlemleri</h3>
                    <ul class="space-y-2 text-sm text-gray-600 list-disc pl-5">
                        <li><strong>TSF Lisans Bilgi Sistemi</strong> Ã¼zerinden online yapÄ±labilir.</li>
                        <li>SaÄŸlÄ±k raporu (Aile hekimi "Spor yapabilir" raporu) gereklidir.</li>
                        <li>Lisans Ã¼creti online veya ilÃ§e temsilciliklerinde Ã¶denebilir.</li>
                    </ul>
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-blue-500">
                    <h3 class="font-bold text-lg mb-2 text-gray-800 flex items-center gap-2"><i class="fa-solid fa-gavel text-blue-500"></i> AltÄ±n Kurallar</h3>
                    <ul class="space-y-2 text-sm text-gray-600 list-disc pl-5">
                        <li><strong>Dokunulan TaÅŸ OynanÄ±r:</strong> Geri dÃ¶nÃ¼ÅŸÃ¼ yok!</li>
                        <li><strong>Ä°mkansÄ±z Hamle:</strong> Åah tehdidi varken baÅŸka taÅŸ oynamak yasaktÄ±r. 2. hatada maÃ§ biter.</li>
                        <li><strong>Saat:</strong> Hamle yap, saate bas, notasyon tut.</li>
                    </ul>
                </div>
            </div>
            <button onclick="app.navTo('home')" class="mt-6 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold mb-32 shadow-md">Ana MenÃ¼ye DÃ¶n</button>
        </div>

        <!-- ARENA & OTHER VIEWS -->
        <div id="view-arena" class="view-section hidden flex flex-col h-full bg-gray-100 overflow-y-auto">
            <div class="bg-white px-4 py-2 flex justify-between items-center shadow-sm shrink-0 z-10">
                <div class="flex bg-gray-100 p-1 rounded-lg"><button onclick="gameManager.setMode('ai')" id="btn-mode-ai" class="px-3 py-1 rounded-md text-xs font-bold bg-white shadow text-blue-600 transition">ğŸ¤– Robot</button><button onclick="gameManager.setMode('pvp')" id="btn-mode-pvp" class="px-3 py-1 rounded-md text-xs font-bold text-gray-500 transition">ğŸ‘¥ ArkadaÅŸ</button></div>
                <div id="ai-controls" class="flex items-center gap-2"><select id="difficulty" class="text-xs bg-gray-100 border border-gray-300 rounded p-1 outline-none font-semibold text-gray-600"><option value="1">Kolay</option><option value="5" selected>Orta</option><option value="10">Zor</option></select></div>
            </div>
            <div class="text-center py-2 bg-blue-50/50 text-blue-800 text-sm font-bold border-b border-blue-100" id="game-status">HazÄ±r mÄ±sÄ±n?</div>
            <div class="flex-none flex items-center justify-center p-2 bg-white/50 relative"><div id="board" class="board-container w-full max-w-[400px]"></div><div id="coach-modal" class="absolute inset-0 z-20 hidden flex items-center justify-center bg-black/40 backdrop-blur-sm p-4 rounded-xl"><div class="bg-white rounded-2xl p-4 w-full max-w-[350px] shadow-2xl border-2 border-indigo-200 pop-in"><div class="flex items-center gap-3 mb-3 border-b pb-2"><div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600"><i class="fa-solid fa-wand-magic-sparkles"></i></div><h3 class="font-bold text-gray-800">Sihirli KoÃ§ Tavsiyesi</h3></div><div id="coach-message" class="text-gray-700 text-sm mb-4 leading-relaxed max-h-40 overflow-y-auto"></div><button onclick="document.getElementById('coach-modal').classList.add('hidden')" class="w-full bg-indigo-600 text-white py-2 rounded-xl font-bold hover:bg-indigo-700 transition">Tamam, Oyuna DÃ¶n</button></div></div></div>
            <div class="bg-white p-4 rounded-t-3xl shadow-[0_-5px_20px_-5px_rgba(0,0,0,0.1)] shrink-0 z-10 pb-32"><div class="flex gap-2 mb-3"><button onclick="gameManager.askCoach()" class="flex-1 bg-indigo-50 text-indigo-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-indigo-100 transition border border-indigo-200 shadow-sm"><i class="fa-solid fa-wand-magic-sparkles text-xl"></i> Sihirli KoÃ§</button></div><div class="grid grid-cols-2 gap-3 mb-4"><button onclick="gameManager.resetGame()" class="bg-gray-100 text-gray-600 py-3 rounded-xl font-bold hover:bg-gray-200 transition"><i class="fa-solid fa-rotate-right mr-2"></i>Yeni Oyun</button><button onclick="gameManager.undo()" class="bg-orange-50 text-orange-500 py-3 rounded-xl font-bold hover:bg-orange-100 transition"><i class="fa-solid fa-rotate-left mr-2"></i>Geri Al</button></div><button onclick="app.navTo('home')" class="bg-gray-200 text-gray-700 py-3 rounded-xl font-bold w-full shadow-md">Ana MenÃ¼ye DÃ¶n</button></div>
        </div>

        <div id="view-lessons" class="view-section hidden p-4 h-full flex flex-col overflow-y-auto"><div class="glass rounded-xl p-3 mb-4 flex justify-between items-center"><h2 class="text-lg font-bold text-blue-800"><i class="fa-solid fa-chalkboard-user mr-2"></i>Dersler</h2><select id="lesson-select" onchange="lessonManager.loadLesson(this.value)" class="bg-white border-none shadow-sm rounded-lg p-2 text-sm font-bold text-gray-700 outline-none ring-1 ring-blue-100"><option value="coban">Ã‡oban MatÄ±</option><option value="aptal">Aptal MatÄ±</option><option value="merdiven">Merdiven MatÄ±</option><option value="bogmaca">BoÄŸmaca MatÄ±</option><option value="arka">Arka Yatay MatÄ±</option></select></div><div class="flex-1 flex items-center justify-center mb-4 min-h-[300px]"><div id="lesson-board" class="board-container w-full max-w-[350px]"></div></div><div class="bg-white p-5 rounded-2xl shadow-lg border border-gray-100 mb-32"><p id="lesson-text" class="text-gray-700 text-center mb-6 min-h-[3rem] font-medium leading-relaxed">Ders seÃ§imi yapÄ±n.</p><div class="flex justify-between gap-4 mb-4"><button onclick="lessonManager.prev()" class="flex-1 py-3 bg-gray-100 rounded-xl text-gray-600 font-bold hover:bg-gray-200 transition"><i class="fa-solid fa-chevron-left mr-1"></i> Geri</button><button onclick="lessonManager.next()" class="flex-1 py-3 bg-blue-600 rounded-xl text-white font-bold hover:bg-blue-700 shadow-md shadow-blue-200 transition">Ä°leri <i class="fa-solid fa-chevron-right ml-1"></i></button></div><button onclick="app.navTo('home')" class="bg-gray-200 text-gray-700 py-3 rounded-xl font-bold w-full shadow-md">Ana MenÃ¼ye DÃ¶n</button></div></div>

        <div id="view-games_hub" class="view-section hidden p-4 h-full flex flex-col items-center overflow-y-auto"><h2 class="text-2xl font-bold text-purple-700 mb-6 brand-font w-full text-center">AkÄ±l OyunlarÄ±</h2><div class="w-full grid grid-cols-1 gap-4 pb-32"><button onclick="app.navTo('minigame_memory')" class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-purple-500 flex items-center gap-4 hover:bg-purple-50 transition"><div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-600 text-2xl"><i class="fa-solid fa-brain"></i></div><div class="text-left"><h3 class="font-bold text-gray-800">HafÄ±za Oyunu</h3><p class="text-xs text-gray-500">Ters kartlarÄ± aÃ§ ve eÅŸleÅŸtir!</p></div></button><button onclick="app.navTo('minigame_math')" class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-green-500 flex items-center gap-4 hover:bg-green-50 transition"><div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-2xl"><i class="fa-solid fa-calculator"></i></div><div class="text-left"><h3 class="font-bold text-gray-800">SatranÃ§ MatematiÄŸi</h3><p class="text-xs text-gray-500">TaÅŸlarÄ±n puanlarÄ±nÄ± topla!</p></div></button><button onclick="app.navTo('minigame_color')" class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-yellow-500 flex items-center gap-4 hover:bg-yellow-50 transition"><div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600 text-2xl"><i class="fa-solid fa-palette"></i></div><div class="text-left"><h3 class="font-bold text-gray-800">Kare Rengi Bulmaca</h3><p class="text-xs text-gray-500">e4 karesi siyah mÄ± beyaz mÄ±?</p></div></button><button onclick="app.navTo('minigame_xox')" class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-blue-500 flex items-center gap-4 hover:bg-blue-50 transition"><div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-2xl"><i class="fa-solid fa-x"></i></div><div class="text-left"><h3 class="font-bold text-gray-800">XOX (Tic-Tac-Toe)</h3><p class="text-xs text-gray-500">ArkadaÅŸÄ±nla veya Robota karÅŸÄ± oyna.</p></div></button><button onclick="app.navTo('minigame_story')" class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-pink-500 flex items-center gap-4 hover:bg-pink-50 transition"><div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center text-pink-600 text-2xl"><i class="fa-solid fa-wand-sparkles"></i></div><div class="text-left"><h3 class="font-bold text-gray-800">Sihirli MasalcÄ± (AI)</h3><p class="text-xs text-gray-500">Kendi oyununu/masalÄ±nÄ± yazdÄ±r.</p></div></button><button onclick="app.navTo('minigame_quiz')" class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-indigo-500 flex items-center gap-4 hover:bg-indigo-50 transition"><div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 text-2xl"><i class="fa-solid fa-question"></i></div><div class="text-left"><h3 class="font-bold text-gray-800">AI SatranÃ§ SÄ±navÄ±</h3><p class="text-xs text-gray-500">Bilgini Ã¶lÃ§, altÄ±n kazan!</p></div></button></div><button onclick="app.navTo('home')" class="mt-auto mb-32 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold w-full shrink-0 shadow-md">Ana MenÃ¼ye DÃ¶n</button></div>

        <!-- MINIGAMES (Memory, Math, Color, XOX, Story, Quiz) -->
        <div id="view-minigame_memory" class="view-section hidden p-4 h-full flex flex-col items-center"><h2 class="text-xl font-bold text-purple-600 mb-2">HafÄ±za Oyunu</h2><div id="memory-grid" class="grid grid-cols-4 gap-2 w-full max-w-[350px]"></div><div class="flex gap-2 w-full mt-6 max-w-[350px]"><button onclick="app.navTo('games_hub')" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold">Geri</button><button onclick="minigameManager.initMemory()" class="flex-1 bg-purple-600 text-white py-3 rounded-xl font-bold">Yenile</button></div><button onclick="app.navTo('home')" class="mt-8 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold w-full max-w-[350px]">Ana MenÃ¼ye DÃ¶n</button></div>
        <div id="view-minigame_math" class="view-section hidden p-4 h-full flex flex-col items-center justify-center"><div class="bg-white p-6 rounded-3xl shadow-xl text-center w-full max-w-sm"><h2 class="text-xl font-bold text-green-600 mb-4">TaÅŸlarÄ± Topla!</h2><div id="math-problem" class="flex justify-center items-center gap-4 mb-6 text-4xl"></div><p class="text-gray-500 mb-4">Toplam puan kaÃ§?</p><div id="math-options" class="grid grid-cols-3 gap-3"></div></div><button onclick="app.navTo('games_hub')" class="mt-8 bg-gray-200 text-gray-700 py-3 px-8 rounded-xl font-bold mb-4">Geri</button><button onclick="app.navTo('home')" class="bg-gray-300 text-gray-700 py-3 px-8 rounded-xl font-bold">Ana MenÃ¼ye DÃ¶n</button></div>
        <div id="view-minigame_color" class="view-section hidden p-4 h-full flex flex-col items-center justify-center"><div class="bg-white p-6 rounded-3xl shadow-xl text-center w-full max-w-sm"><h2 class="text-xl font-bold text-yellow-600 mb-4">Kare Rengi Ne?</h2><div id="color-problem" class="text-5xl font-mono font-bold text-gray-800 mb-8 bg-gray-100 p-4 rounded-xl">e4</div><div class="flex gap-4"><button onclick="minigameManager.checkColor('white')" class="flex-1 bg-white border-2 border-gray-200 text-gray-800 py-4 rounded-xl font-bold shadow-sm hover:bg-gray-50">BEYAZ</button><button onclick="minigameManager.checkColor('black')" class="flex-1 bg-gray-800 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-gray-900">SÄ°YAH</button></div></div><button onclick="app.navTo('games_hub')" class="mt-8 bg-gray-200 text-gray-700 py-3 px-8 rounded-xl font-bold mb-4">Geri</button><button onclick="app.navTo('home')" class="bg-gray-300 text-gray-700 py-3 px-8 rounded-xl font-bold">Ana MenÃ¼ye DÃ¶n</button></div>
        <div id="view-minigame_xox" class="view-section hidden p-4 h-full flex flex-col items-center"><h2 class="text-xl font-bold text-blue-600 mb-2">XOX</h2><div class="bg-white p-2 rounded-lg mb-4 flex gap-2"><button id="xox-mode-pvp" onclick="minigameManager.setXoxMode('pvp')" class="px-4 py-1 bg-blue-100 text-blue-700 rounded-md text-sm font-bold">ArkadaÅŸ</button><button id="xox-mode-ai" onclick="minigameManager.setXoxMode('ai')" class="px-4 py-1 text-gray-500 rounded-md text-sm font-bold">Robot</button></div><div id="xox-status" class="mb-4 font-bold text-gray-600">SÄ±ra: X</div><div id="xox-grid" class="grid grid-cols-3 gap-2 bg-gray-300 p-2 rounded-xl w-[300px]"></div><button onclick="app.navTo('games_hub')" class="mt-6 bg-gray-200 text-gray-700 py-3 px-8 rounded-xl font-bold mb-4">Geri</button><button onclick="app.navTo('home')" class="bg-gray-300 text-gray-700 py-3 px-8 rounded-xl font-bold">Ana MenÃ¼ye DÃ¶n</button></div>
        <div id="view-minigame_story" class="view-section hidden p-4 h-full flex flex-col"><h2 class="text-xl font-bold text-pink-600 mb-2">Sihirli MasalcÄ±</h2><div class="bg-white p-4 rounded-xl shadow-sm mb-4"><label class="block text-sm font-bold text-gray-700 mb-2">Ne hakkÄ±nda bir oyun/masal istiyorsun?</label><textarea id="story-prompt" class="w-full p-3 bg-gray-50 rounded-lg border focus:ring-2 focus:ring-pink-200 outline-none text-sm" rows="2" placeholder="Ã–rn: Uzayda satranÃ§ oynayan bir kedi..."></textarea><button onclick="minigameManager.generateStory()" class="w-full mt-2 bg-pink-500 text-white py-2 rounded-lg font-bold hover:bg-pink-600"><i class="fa-solid fa-pen-nib mr-1"></i> OluÅŸtur</button></div><div id="story-output" class="flex-1 bg-white rounded-xl p-4 shadow-inner overflow-y-auto text-sm leading-relaxed text-gray-700 border border-gray-100">MasalÄ±nÄ± bekliyorum...</div><div class="flex gap-2 mt-4 mb-32"><button onclick="app.navTo('games_hub')" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold">Geri</button><button onclick="app.navTo('home')" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-xl font-bold">Ana MenÃ¼</button></div></div>
        <div id="view-minigame_quiz" class="view-section hidden p-4 h-full flex flex-col items-center">
            <h2 class="text-xl font-bold text-indigo-600 mb-4">AI SatranÃ§ SÄ±navÄ±</h2>
            <div class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-sm">
                <div id="quiz-question" class="text-gray-800 font-bold mb-4 text-center">Soru yÃ¼kleniyor...</div>
                <div id="quiz-options" class="flex flex-col gap-2"></div>
                <div id="quiz-feedback" class="mt-4 text-center font-bold hidden"></div>
            </div>
            <button onclick="minigameManager.initQuiz()" class="mt-4 bg-indigo-500 text-white py-2 px-6 rounded-xl font-bold hover:bg-indigo-600">Yeni Soru Sor</button>
            <button onclick="app.navTo('games_hub')" class="mt-2 bg-gray-200 text-gray-700 py-3 px-8 rounded-xl font-bold">Geri</button>
            <button onclick="app.navTo('home')" class="mt-2 bg-gray-300 text-gray-700 py-3 px-8 rounded-xl font-bold">Ana MenÃ¼ye DÃ¶n</button>
        </div>

        <!-- MARKET -->
        <div id="view-market" class="view-section hidden p-4 h-full flex flex-col"><div class="bg-gradient-to-r from-emerald-500 to-teal-500 rounded-3xl p-6 text-white mb-6 shadow-xl shadow-emerald-200 relative overflow-hidden shrink-0"><div class="relative z-10"><h2 class="text-2xl font-bold mb-1 brand-font">SatranÃ§ PazarÄ±</h2><p class="opacity-90 text-sm">Zafer kazan, altÄ±n topla!</p><div class="mt-4 bg-white/20 backdrop-blur-sm inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-white/30"><i class="fa-solid fa-coins text-yellow-300 text-xl"></i><span id="market-gold" class="font-mono font-bold text-2xl">0</span></div></div></div><div class="flex gap-2 mb-4 bg-white p-1 rounded-xl shadow-sm overflow-x-auto no-scrollbar shrink-0"><button onclick="marketManager.setFilter('board')" id="tab-board" class="flex-1 py-2 px-4 whitespace-nowrap rounded-lg text-sm font-bold text-gray-500 hover:bg-gray-50 transition">Tahta</button><button onclick="marketManager.setFilter('pieces')" id="tab-pieces" class="flex-1 py-2 px-4 whitespace-nowrap rounded-lg text-sm font-bold text-gray-500 hover:bg-gray-50 transition">TaÅŸlar</button><button onclick="marketManager.setFilter('avatar')" id="tab-avatar" class="flex-1 py-2 px-4 whitespace-nowrap rounded-lg text-sm font-bold text-gray-500 hover:bg-gray-50 transition">Avatar</button><button onclick="marketManager.setFilter('special')" id="tab-special" class="flex-1 py-2 px-4 whitespace-nowrap rounded-lg text-sm font-bold text-gray-500 hover:bg-gray-50 transition">Ã–zel</button><button onclick="marketManager.setFilter('rank')" id="tab-rank" class="flex-1 py-2 px-4 whitespace-nowrap rounded-lg text-sm font-bold text-gray-500 hover:bg-gray-50 transition">RÃ¼tbe</button></div><div id="market-grid" class="grid grid-cols-2 gap-4 pb-32 overflow-y-auto no-scrollbar flex-1"></div><button onclick="app.navTo('home')" class="mt-4 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold w-full shrink-0 mb-32 shadow-md">Ana MenÃ¼ye DÃ¶n</button></div>

        <!-- SETTINGS -->
        <div id="view-settings" class="view-section hidden p-6 overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 brand-font">Ayarlar</h2>
            <!-- ADMIN PANEL -->
            <div id="admin-panel" class="hidden bg-red-50 p-5 rounded-2xl shadow-sm border border-red-200 mb-4"><div class="flex items-center gap-2 mb-3 text-red-700 border-b border-red-100 pb-2"><i class="fa-solid fa-user-shield"></i><label class="font-bold">Ã–ÄŸretmen Paneli (En Ã‡ok Girenler)</label></div><div id="admin-user-list" class="space-y-2 text-sm max-h-60 overflow-y-auto"></div></div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 mb-4"><div class="flex items-center gap-2 mb-3"><i class="fa-solid fa-user text-blue-600"></i><label class="font-bold text-gray-700">Oturum</label></div><p class="text-sm text-gray-600 mb-2">GiriÅŸ yapan: <strong id="settings-username">...</strong></p><button onclick="app.logout()" class="w-full bg-gray-200 text-gray-700 py-2 rounded-xl text-sm font-bold hover:bg-gray-300">Ã‡Ä±kÄ±ÅŸ Yap</button></div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 mb-4"><div class="flex items-center gap-3 mb-3"><div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600"><i class="fa-solid fa-key"></i></div><label class="font-bold text-gray-700">Gemini API AnahtarÄ±</label></div><input type="password" id="api-key-input" placeholder="AI Studio Key..." class="w-full p-3 border rounded-xl bg-gray-50 text-sm mb-3 outline-none focus:ring-2 focus:ring-blue-200 transition"><button onclick="app.saveApiKey()" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm w-full font-bold shadow-lg">Kaydet</button></div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-orange-100 mb-4"><div class="flex items-center gap-3 mb-3"><div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600"><i class="fa-solid fa-floppy-disk"></i></div><label class="font-bold text-gray-700">Ä°lerlemeyi Yedekle</label></div><div class="flex gap-2"><button onclick="app.exportSave()" class="flex-1 bg-orange-500 text-white py-2 rounded-lg text-xs font-bold hover:bg-orange-600">Kod Al</button><button onclick="app.importSave()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg text-xs font-bold hover:bg-gray-300">Yedek YÃ¼kle</button></div></div>
            <button onclick="app.resetData()" class="w-full border border-red-100 bg-red-50 text-red-500 py-4 rounded-2xl text-sm font-bold hover:bg-red-100 transition mb-4">KullanÄ±cÄ± Verilerini Sil</button>
            <button onclick="app.navTo('home')" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-bold mb-32 shadow-md">Ana MenÃ¼ye DÃ¶n</button>
        </div>
        
        <!-- OTHER -->
        <div id="view-cinema" class="view-section hidden p-4 h-full overflow-y-auto">
             <h2 class="text-2xl font-bold text-pink-600 mb-4 brand-font"><i class="fa-solid fa-film mr-2"></i>SatranÃ§ SinemasÄ±</h2>
             <div class="grid grid-cols-1 gap-4 pb-20">
                <a href="https://www.youtube.com/results?search_query=geri%27s+game+pixar" target="_blank" class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition group"><div class="h-32 bg-gray-200 relative"><img src="https://upload.wikimedia.org/wikipedia/en/a/a3/Geri%27s_Game_poster.jpg" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition"><div class="absolute inset-0 flex items-center justify-center"><i class="fa-solid fa-play-circle text-5xl text-white drop-shadow-lg"></i></div></div><div class="p-4"><h3 class="font-bold text-gray-800">Geri's Game (Pixar)</h3></div></a>
                <a href="https://www.youtube.com/results?search_query=harry+potter+chess+scene" target="_blank" class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition group"><div class="h-32 bg-gray-800 relative flex items-center justify-center bg-purple-900"><i class="fa-solid fa-hat-wizard text-5xl text-white"></i></div><div class="p-4"><h3 class="font-bold text-gray-800">Harry Potter SatranÃ§</h3></div></a>
                <a href="https://www.youtube.com/results?search_query=satran%C3%A7+dersleri+%C3%A7ocuklar+i%C3%A7in" target="_blank" class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition group"><div class="h-32 bg-blue-100 relative flex items-center justify-center"><i class="fa-brands fa-youtube text-5xl text-red-600 drop-shadow-lg opacity-80 group-hover:scale-110 transition"></i></div><div class="p-4"><h3 class="font-bold text-gray-800">Ã‡ocuklar Ä°Ã§in EÄŸitim VideolarÄ±</h3><p class="text-xs text-gray-500">YouTube Listesi</p></div></a>
             </div>
             <button onclick="app.navTo('home')" class="mt-2 bg-gray-200 text-gray-700 py-3 rounded-xl font-bold w-full mb-32 shadow-md">Ana MenÃ¼ye DÃ¶n</button>
        </div>
    </main>

    <!-- ROBOT BUTTON -->
    <button onclick="chatManager.toggle()" class="fixed bottom-24 right-4 bg-gradient-to-tr from-blue-500 to-cyan-400 text-white w-16 h-16 rounded-full shadow-2xl z-40 flex items-center justify-center text-3xl hover:scale-110 transition duration-300 pop-in robot-container"><i class="fa-solid fa-robot group-hover:animate-bounce"></i></button>

    <!-- CHAT MODAL -->
    <div id="chat-modal" class="fixed inset-0 z-50 hidden flex flex-col justify-end sm:justify-center sm:items-center bg-black/20 backdrop-blur-sm">
        <div class="bg-white w-full h-[85vh] sm:h-[600px] sm:w-[400px] sm:rounded-3xl rounded-t-3xl shadow-2xl flex flex-col chat-slide-in overflow-hidden border-t border-white/50">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 text-white flex justify-between items-center shrink-0">
                <div class="flex items-center gap-3"><div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl border border-white/30 robot-glow"><i class="fa-solid fa-robot"></i></div><div><h3 class="font-bold text-lg">DeÄŸiÅŸim Robotu</h3><p class="text-blue-200 text-xs flex items-center gap-1"><span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span> Ã‡evrimiÃ§i</p></div></div>
                <div class="flex items-center gap-2"><button onclick="chatManager.toggleVoice()" id="voice-btn" class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition border border-white/10"><i id="voice-icon" class="fa-solid fa-volume-xmark text-white/70"></i></button><button onclick="chatManager.toggle()" class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition border border-white/10"><i class="fa-solid fa-chevron-down"></i></button></div>
            </div>
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 flex flex-col gap-3 bg-gray-50"><div class="chat-message chat-bot">Selam! ğŸ‘‹ Ben DeÄŸiÅŸim Koleji SatranÃ§ Robotu.</div></div>
            <div class="p-3 bg-white border-t border-gray-100 flex gap-2 shrink-0 pb-safe"><input type="text" id="chat-input" placeholder="Bir soru sor..." class="flex-1 bg-gray-100 border-none rounded-2xl px-5 py-3 outline-none focus:ring-2 focus:ring-blue-200 transition font-medium"><button onclick="chatManager.send()" id="chat-send-btn" class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-blue-700 transition shadow-lg"><i class="fa-solid fa-paper-plane"></i></button></div>
        </div>
    </div>

    <!-- GENERIC MODAL -->
    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden backdrop-blur-sm p-4">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm text-center shadow-2xl pop-in relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-purple-500"></div>
            <div id="modal-icon" class="text-6xl mb-4 mt-2">ğŸ†</div>
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-2 brand-font">BaÅŸlÄ±k</h3>
            <p id="modal-message" class="text-gray-600 mb-8 leading-relaxed">Mesaj.</p>
            <div id="modal-sec-btn-container" class="mb-2 hidden"></div>
            <button id="modal-btn" onclick="app.closeModal()" class="bg-blue-600 text-white w-full py-3.5 rounded-xl font-bold text-lg hover:bg-blue-700 shadow-lg transition transform active:scale-95">Tamam</button>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

    <script>
        /** AUDIO MANAGER */
        const audioManager = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            playTone: function(freq, type, duration) {
                if(this.ctx.state === 'suspended') this.ctx.resume();
                const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain();
                osc.type = type; osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
                osc.connect(gain); gain.connect(this.ctx.destination); osc.start(); osc.stop(this.ctx.currentTime + duration);
            },
            move: function() { this.playTone(300, 'sine', 0.1); },
            win: function() { this.playTone(600, 'triangle', 0.2); setTimeout(()=>this.playTone(800, 'triangle', 0.4), 200); },
            error: function() { this.playTone(150, 'sawtooth', 0.3); }
        };

        /** TOOLS MANAGER */
        const toolsManager = {
            drawing: false, canvas: null, ctx: null, painting: false,
            init: function() {
                this.canvas = document.getElementById('drawing-canvas'); this.ctx = this.canvas.getContext('2d');
                this.resize(); window.addEventListener('resize', () => this.resize());
                const start = (e) => { if(!this.drawing) return; this.painting = true; this.draw(e); };
                const end = () => { this.painting = false; this.ctx.beginPath(); };
                const move = (e) => { if(this.painting) this.draw(e); };
                this.canvas.addEventListener('mousedown', start); this.canvas.addEventListener('touchstart', start);
                this.canvas.addEventListener('mouseup', end); this.canvas.addEventListener('touchend', end);
                this.canvas.addEventListener('mousemove', move); this.canvas.addEventListener('touchmove', move);
            },
            resize: function() { this.canvas.width = window.innerWidth; this.canvas.height = window.innerHeight; },
            toggleDrawing: function() {
                this.drawing = !this.drawing; const btn = document.getElementById('btn-draw');
                if(this.drawing) { this.canvas.classList.add('drawing-active'); btn.classList.add('bg-red-500', 'text-white'); btn.classList.remove('bg-white', 'text-gray-600'); } 
                else { this.canvas.classList.remove('drawing-active'); this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); btn.classList.remove('bg-red-500', 'text-white'); btn.classList.add('bg-white', 'text-gray-600'); }
            },
            draw: function(e) {
                this.ctx.lineWidth = 5; this.ctx.lineCap = 'round'; this.ctx.strokeStyle = '#ef4444';
                const x = e.clientX || e.touches[0].clientX; const y = e.clientY || e.touches[0].clientY;
                this.ctx.lineTo(x, y); this.ctx.stroke(); this.ctx.beginPath(); this.ctx.moveTo(x, y);
            },
            toggleFullscreen: function() {
                if (!document.fullscreenElement) { if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen().catch(() => {}); }
                else if (document.exitFullscreen) document.exitFullscreen().catch(() => {});
            }
        };

        /** APP LOGIC */
        const app = {
            currentUser: null,
            users: {},
            defaultState: { gold: 0, wins: 0, logins: 0, inventory: ['classic', 'piece-wiki', 'avatar-default'], equippedTheme: 'classic', equippedPieceSet: 'wikipedia', equippedAvatar: 'avatar-default', apiKey: '', version: '12.0' },
            quotes: [
                "SatranÃ§ zihnin jimnastiÄŸidir. - Pascal", "SatranÃ§ta en gÃ¼Ã§lÃ¼ silah sabÄ±rdÄ±r.", "Piyonlar satrancÄ±n ruhudur. - Philidor",
                "Ä°yi oyuncu her zaman ÅŸanslÄ±dÄ±r. - Capablanca", "Hata yapmaktan korkma, Ã¶ÄŸrenmemekten kork.", "SatranÃ§ tahtasÄ±nda yalan ve ikiyÃ¼zlÃ¼lÃ¼k yaÅŸayamaz. - Lasker",
                "SatranÃ§, analiz sanatÄ±dÄ±r. - Botvinnik", "Kazananlar hiÃ§ hata yapmayanlar deÄŸil, asla vazgeÃ§meyenlerdir."
            ],
            
            // EXTRA FACTS FOR ROTATION
            facts: [
                "Ä°lk satranÃ§ saati kum saatiydi! â³", "SatranÃ§ta ilk 4 hamlede 300 milyar olasÄ±lÄ±k vardÄ±r.", "En uzun satranÃ§ maÃ§Ä± 269 hamle sÃ¼rmÃ¼ÅŸtÃ¼r.", "SatranÃ§ 1500 yÄ±l Ã¶nce Hindistan'da doÄŸdu.", "Rok hamlesi, ÅŸahÄ± korumanÄ±n en iyi yoludur."
            ],

            init: function() {
                const savedUsers = localStorage.getItem('chessApp_users');
                if (savedUsers) { try { this.users = JSON.parse(savedUsers); } catch(e){ this.users = {}; } }
                
                // FORCE CLEAN - DELETE MOCK DATA EVERY INIT TO BE SURE
                ['Ahmet YÄ±lmaz', 'Zeynep Demir', 'Mehmet Can', 'Ahmet', 'Mehmet', 'Zeynep', 'Ali (Ã–rnek)', 'AyÅŸe (Ã–rnek)', 'Veli (Ã–rnek)'].forEach(n => delete this.users[n]);
                localStorage.setItem('chessApp_users', JSON.stringify(this.users));

                const sessionUser = sessionStorage.getItem('chessApp_session');
                if (sessionUser && this.users[sessionUser]) {
                    this.currentUser = sessionUser;
                    document.getElementById('login-overlay').classList.add('hidden');
                    this.updateUI(); this.updateLeaderboard(); this.rotateQuotes();
                } else { document.getElementById('login-overlay').classList.remove('hidden'); }
                marketManager.render(); toolsManager.init();
            },
            
            rotateQuotes: function() {
                const el = document.getElementById('rotating-quote');
                if(!el) return;
                const content = [...this.quotes, ...this.facts]; // Mix quotes and facts
                let i = 0;
                const showQuote = () => {
                    el.classList.remove('fade-text'); void el.offsetWidth; 
                    el.innerText = content[Math.floor(Math.random() * content.length)]; 
                    el.classList.add('fade-text');
                };
                showQuote(); setInterval(showQuote, 6000);
            },

            login: function() {
                const n = document.getElementById('login-name').value.trim();
                const p = document.getElementById('login-pass').value.trim();
                if (!n) return alert("LÃ¼tfen adÄ±nÄ± yaz.");
                if (p.toLowerCase() !== 'barÄ±ÅŸ') return alert("Åifre yanlÄ±ÅŸ!");
                this.currentUser = n;
                if (!this.users[this.currentUser]) this.users[this.currentUser] = JSON.parse(JSON.stringify(this.defaultState));
                this.users[this.currentUser].logins += 1;
                
                this.saveGlobal(); sessionStorage.setItem('chessApp_session', this.currentUser);
                document.getElementById('login-overlay').classList.add('opacity-0');
                setTimeout(() => { document.getElementById('login-overlay').classList.add('hidden'); this.updateUI(); this.updateLeaderboard(); this.rotateQuotes(); app.showModal('HoÅŸgeldin!', 'BaÅŸarÄ±lar ' + this.currentUser, 'ğŸ‘‹'); }, 500);
            },

            logout: function() { this.currentUser = null; sessionStorage.removeItem('chessApp_session'); location.reload(); },
            saveGlobal: function() { localStorage.setItem('chessApp_users', JSON.stringify(this.users)); this.updateUI(); this.updateLeaderboard(); },
            u: function() { if (!this.currentUser) return this.defaultState; return this.users[this.currentUser]; },

            addGold: function(amount) { if(!this.currentUser) return; this.users[this.currentUser].gold += amount; this.saveGlobal(); const el = document.getElementById('gold-display'); if(el) { el.classList.add('gold-pulse'); setTimeout(() => el.classList.remove('gold-pulse'), 1500); } },
            addWin: function() { if(!this.currentUser) return; this.users[this.currentUser].wins += 1; this.saveGlobal(); },
            spendGold: function(amount) { if(!this.currentUser) return false; if (this.users[this.currentUser].gold >= amount) { this.users[this.currentUser].gold -= amount; this.saveGlobal(); return true; } return false; },
            saveApiKey: function() { if(!this.currentUser) return; const k = document.getElementById('api-key-input').value.trim(); this.users[this.currentUser].apiKey = k; this.saveGlobal(); this.showModal('Kaydedildi', 'API anahtarÄ± hazÄ±r.', 'âœ…'); },
            exportSave: function() { if(!this.currentUser) return; const d = btoa(JSON.stringify(this.users[this.currentUser])); prompt("Kodun:", d); },
            importSave: function() { if(!this.currentUser) return; const d = prompt("Kod:"); if(d) { try { const p = JSON.parse(atob(d)); this.users[this.currentUser] = { ...this.users[this.currentUser], ...p }; this.saveGlobal(); alert("YÃ¼klendi!"); location.reload(); } catch(e) { alert("Hata!"); } } },
            resetData: function() { if(confirm('Her ÅŸey silinecek?')) { localStorage.removeItem('chessApp_users'); location.reload(); } },
            checkUpdates: function() { this.showModal('SÃ¼rÃ¼m', 'v12.0 (BarÄ±ÅŸ Ã–ÄŸretmen)', 'ğŸš€'); },
            deleteUser: function(name) { if(confirm(name + " silinsin mi?")) { delete this.users[name]; this.saveGlobal(); this.renderAdminPanel(); } },
            calculateRank: function() { const g = this.u().gold; if(g < 100) return "ACEMÄ°"; if(g < 300) return "Ã‡IRAK"; if(g < 600) return "OYUNCU"; if(g < 1000) return "USTA"; if(g < 2000) return "BÃœYÃœKUSTA"; return "EFSANE"; },
            
            // ROBUST ADMIN CHECK
            isAdmin: function(name) {
                const n = (name || this.currentUser).toLowerCase();
                const hasBaris = n.indexOf('baris') !== -1 || n.indexOf('barÄ±ÅŸ') !== -1;
                return hasBaris;
            },

            renderAdminPanel: function() {
                const list = document.getElementById('admin-user-list'); list.innerHTML = '';
                // Sort by logins (most active first)
                const sortedUsers = Object.keys(this.users).sort((a,b) => this.users[b].logins - this.users[a].logins);
                
                sortedUsers.forEach(name => {
                    if(this.isAdmin(name)) return;
                    const u = this.users[name];
                    list.innerHTML += `<div class="flex justify-between items-center bg-white p-2 rounded-lg border border-red-100"><div class="flex flex-col"><span class="font-bold text-gray-800">${name}</span><span class="text-xs text-gray-500">AltÄ±n: ${u.gold} | Win: ${u.wins} | Login: ${u.logins}</span></div><button onclick="app.deleteUser('${name}')" class="text-red-500 hover:bg-red-50 p-1 rounded"><i class="fa-solid fa-trash"></i></button></div>`;
                });
                if(list.innerHTML === '') list.innerHTML = '<div class="text-gray-400 text-center text-xs">HenÃ¼z Ã¶ÄŸrenci yok.</div>';
            },

            updateLeaderboard: function() {
                if (!document.getElementById('leaderboard-wins')) return;
                const userList = Object.keys(this.users).filter(name => !this.isAdmin(name)).map(k => ({ name: k, ...this.users[k] }));
                const w = [...userList].sort((a,b) => b.wins - a.wins).slice(0, 3);
                let wh = ""; w.forEach((u, i) => wh += `<div class="flex justify-between text-xs mb-1"><span>${i+1}. ${u.name}</span><span class="font-bold text-orange-600">${u.wins} ğŸ†</span></div>`);
                document.getElementById('leaderboard-wins').innerHTML = wh || "HenÃ¼z yok.";
                const l = [...userList].sort((a,b) => b.logins - a.logins).slice(0, 3);
                let lh = ""; l.forEach((u, i) => lh += `<div class="flex justify-between text-xs mb-1"><span>${i+1}. ${u.name}</span><span class="font-bold text-blue-600">${u.logins} ğŸšª</span></div>`);
                document.getElementById('leaderboard-logins').innerHTML = lh || "HenÃ¼z yok.";
            },

            updateUI: function() {
                if(!this.currentUser) return;
                const u = this.u();
                document.getElementById('display-name').innerText = this.currentUser;
                document.getElementById('user-rank').innerText = this.calculateRank();
                document.getElementById('gold-display').innerText = u.gold;
                document.getElementById('market-gold').innerText = u.gold;
                document.getElementById('settings-username').innerText = this.currentUser;
                const i = document.getElementById('api-key-input'); if(i) i.value = u.apiKey || '';
                
                const av = { 'avatar-default': 'https://cdn-icons-png.flaticon.com/512/4359/4359868.png', 'avatar-king': 'https://cdn-icons-png.flaticon.com/512/3039/3039396.png', 'avatar-pawn': 'https://cdn-icons-png.flaticon.com/512/2640/2640854.png', 'avatar-queen': 'https://cdn-icons-png.flaticon.com/512/963/963728.png', 'avatar-super': 'https://cdn-icons-png.flaticon.com/512/1674/1674291.png', 'avatar-ninja': 'https://cdn-icons-png.flaticon.com/512/3063/3063823.png', 'avatar-princess': 'https://cdn-icons-png.flaticon.com/512/2065/2065176.png', 'avatar-hero': 'https://cdn-icons-png.flaticon.com/512/4043/4043191.png', 'avatar-unicorn': 'https://cdn-icons-png.flaticon.com/512/2396/2396920.png', 'avatar-robot-king': 'https://cdn-icons-png.flaticon.com/512/4255/4255686.png' };
                const el = document.getElementById('user-avatar'); if(el) el.src = av[u.equippedAvatar] || av['avatar-default'];

                // ADMIN PANEL LOGIC
                const adminPanel = document.getElementById('admin-panel');
                if (this.isAdmin()) { adminPanel.classList.remove('hidden'); this.renderAdminPanel(); } 
                else { adminPanel.classList.add('hidden'); }
            },

            navTo: function(viewId) {
                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                const t = document.getElementById('view-' + viewId); if(t) t.classList.remove('hidden');
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const i = btn.querySelector('i');
                    if (btn.dataset.target === viewId || (viewId.startsWith('minigame') && btn.dataset.target === 'games_hub') || (viewId === 'stories' && btn.dataset.target === 'home') || (viewId === 'minigame_quiz' && btn.dataset.target === 'games_hub')) {
                        btn.classList.remove('inactive-tab'); btn.classList.add('active-tab'); if(i) { i.classList.add('text-blue-600'); i.classList.remove('text-gray-400'); }
                    } else {
                        btn.classList.add('inactive-tab'); btn.classList.remove('active-tab'); if(i) { i.classList.remove('text-blue-600'); i.classList.add('text-gray-400'); }
                    }
                });
                if(viewId === 'arena') gameManager.resize();
                if(viewId === 'lessons') lessonManager.resize();
                if(viewId === 'minigame_memory') minigameManager.initMemory();
                if(viewId === 'minigame_xox') minigameManager.initXox();
                if(viewId === 'minigame_math') minigameManager.initMath();
                if(viewId === 'minigame_quiz') minigameManager.initQuiz();
            },

            showModal: function(title, msg, icon='â„¹ï¸', btnText='Tamam', secondaryBtn=null) {
                document.getElementById('modal-title').innerText = title; document.getElementById('modal-message').innerText = msg; document.getElementById('modal-icon').innerText = icon;
                const m = document.getElementById('modal-btn'); m.innerText = btnText; m.onclick = () => app.closeModal();
                const s = document.getElementById('modal-sec-btn-container');
                if(secondaryBtn) { s.innerHTML = `<button onclick="${secondaryBtn.onclick}" class="w-full mt-2 bg-purple-100 text-purple-700 py-3 rounded-xl font-bold hover:bg-purple-200 transition">${secondaryBtn.text}</button>`; s.classList.remove('hidden'); } else { s.classList.add('hidden'); }
                document.getElementById('modal').classList.remove('hidden');
            },
            closeModal: function() { document.getElementById('modal').classList.add('hidden'); }
        };

        const chatManager = {
            isOpen: false, isVoiceOn: false,
            toggle: function() { const m = document.getElementById('chat-modal'); this.isOpen = !this.isOpen; if(this.isOpen) { m.classList.remove('hidden'); document.getElementById('chat-input').focus(); } else { m.classList.add('hidden'); if (window.speechSynthesis) window.speechSynthesis.cancel(); } },
            toggleVoice: function() { this.isVoiceOn = !this.isVoiceOn; const i = document.getElementById('voice-icon'); if (this.isVoiceOn) { i.className="fa-solid fa-volume-high text-white"; this.speak("Ses aÃ§Ä±k."); } else { i.className="fa-solid fa-volume-xmark text-white/70"; if (window.speechSynthesis) window.speechSynthesis.cancel(); } },
            speak: function(t) { if (!this.isVoiceOn || !window.speechSynthesis) return; window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(t.replace(/[*#`_]/g, '')); u.lang = 'tr-TR'; u.rate = 1.0; u.pitch = 1.1; window.speechSynthesis.speak(u); },
            addMessage: function(t, s) { const c = document.getElementById('chat-messages'); const d = document.createElement('div'); d.className = `chat-message ${s === 'user' ? 'chat-user' : 'chat-bot'}`; if(s === 'bot') { d.innerHTML = marked.parse(t); this.speak(t); } else { d.innerText = t; } c.appendChild(d); c.scrollTop = c.scrollHeight; },
            send: async function() {
                const i = document.getElementById('chat-input'); const t = i.value.trim(); if(!t) return;
                this.addMessage(t, 'user'); i.value = ''; const b = document.getElementById('chat-send-btn'); b.disabled = true;
                let key = app.u().apiKey; // No default key provided in code for public version to force error message
                
                if(!key || key.length < 10) {
                     this.addMessage("Hata! Sohbet etmek iÃ§in BarÄ±ÅŸ Ã–ÄŸretmeninizden API anahtarÄ±nÄ± isteyin ve Ayarlar menÃ¼sÃ¼ne girin.", 'bot');
                     b.disabled = false;
                     return;
                }

                try { const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: `Sen "DeÄŸiÅŸim Koleji SatranÃ§ Robotu"sun. Soru: "${t}". KÄ±sa, TÃ¼rkÃ§e, Ã§ocuklara uygun cevap ver.` }] }] }) }); const d = await r.json(); 
                if(d.error) throw new Error();
                this.addMessage(d.candidates?.[0]?.content?.parts?.[0]?.text || "Hata.", 'bot'); } catch(e) { this.addMessage("BaÄŸlantÄ± hatasÄ± veya geÃ§ersiz anahtar. BarÄ±ÅŸ Ã–ÄŸretmen'e danÄ±ÅŸÄ±n.", 'bot'); } finally { b.disabled = false; }
            }
        };
        document.getElementById('chat-input').addEventListener('keypress', function (e) { if (e.key === 'Enter') chatManager.send(); });

        const gameManager = {
            game: new Chess(), board: null, stockfish: null, mode: 'ai',
            init: function() { fetch('https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.0/stockfish.js').then(r=>r.text()).then(s=>{ const b=new Blob([s],{type:'application/javascript'}); this.stockfish=new Worker(window.URL.createObjectURL(b)); this.stockfish.onmessage=(e)=>this.handleEngineMessage(e.data); this.stockfish.postMessage('uci'); }); this.initBoard(); },
            setMode: function(m) { this.mode = m; const bA = document.getElementById('btn-mode-ai'); const bP = document.getElementById('btn-mode-pvp'); const c = document.getElementById('ai-controls'); if(m === 'ai') { bA.className="px-3 py-1 rounded-md text-xs font-bold bg-white shadow text-blue-600 transition"; bP.className="px-3 py-1 rounded-md text-xs font-bold text-gray-500 transition"; c.classList.remove('hidden'); } else { bP.className="px-3 py-1 rounded-md text-xs font-bold bg-white shadow text-blue-600 transition"; bA.className="px-3 py-1 rounded-md text-xs font-bold text-gray-500 transition"; c.classList.add('hidden'); } this.resetGame(); },
            initBoard: function() { this.board = Chessboard('board', { draggable: true, position: 'start', onDragStart: this.onDragStart, onDrop: this.onDrop, onSnapEnd: this.onSnapEnd, pieceTheme: this.getPieceTheme }); window.addEventListener('resize', this.board.resize); },
            resize: function() { setTimeout(() => { if(this.board) this.board.resize(); }, 100); },
            getPieceTheme: function(p) { const s = app.u().equippedPieceSet || 'wikipedia'; return 'https://chessboardjs.com/img/chesspieces/' + s + '/' + p + '.png'; },
            resetGame: function() { this.game.reset(); this.board.start(); this.updateStatus(); },
            undo: function() { this.game.undo(); if(this.mode === 'ai') this.game.undo(); this.board.position(this.game.fen()); this.updateStatus(); },
            onDragStart: function(s, p) { if (gameManager.game.game_over()) return false; if (gameManager.mode === 'ai') { if ((gameManager.game.turn() === 'w' && p.search(/^b/) !== -1) || (gameManager.game.turn() === 'b' && p.search(/^w/) !== -1)) return false; } },
            onDrop: function(s, t) { const m = gameManager.game.move({ from: s, to: t, promotion: 'q' }); if (m === null) { audioManager.error(); return 'snapback'; } audioManager.move(); gameManager.updateStatus(); if (gameManager.mode === 'ai') gameManager.makeEngineMove(); },
            onSnapEnd: function() { gameManager.board.position(gameManager.game.fen()); },
            makeEngineMove: function() { if(this.game.game_over()) return; const d = document.getElementById('difficulty').value; document.getElementById('game-status').innerText = "Robot DÃ¼ÅŸÃ¼nÃ¼yor... ğŸ¤”"; this.stockfish.postMessage('position fen ' + this.game.fen()); this.stockfish.postMessage('go depth ' + d); },
            handleEngineMessage: function(m) { if (m.startsWith('bestmove')) { const md = m.split(' ')[1]; this.game.move({ from: md.substring(0, 2), to: md.substring(2, 4), promotion: md.length > 4 ? md.substring(4, 5) : undefined }); this.board.position(this.game.fen()); audioManager.move(); this.updateStatus(); } },
            updateStatus: function() {
                let s = ''; const t = this.game.turn() === 'w' ? 'Beyaz' : 'Siyah';
                if (this.game.in_checkmate()) { s = 'Oyun Bitti!'; confetti({ particleCount: 150 }); audioManager.win(); if(app.currentUser) { if(this.mode === 'ai' && this.game.turn() === 'b') { app.addGold(50); app.addWin(); app.showModal('Zafer!', '+50 AltÄ±n', 'ğŸ†', 'Tamam', { text: "Karne Ä°ste", onclick: `gameManager.generateReport('Galibiyet')` }); } else if(this.mode === 'pvp') { app.addGold(25); app.addWin(); app.showModal('Oyun Bitti', '+25 AltÄ±n', 'ğŸ¤', 'Tamam', { text: "Karne Ä°ste", onclick: `gameManager.generateReport('ArkadaÅŸ MaÃ§Ä±')` }); } } } 
                else if (this.game.in_draw()) s = 'Berabere'; else { s = (t === 'Beyaz') ? 'SÄ±ra Beyazda' : 'SÄ±ra Siyahda'; if (this.game.in_check()) s = 'ÅAH! ' + s; }
                document.getElementById('game-status').innerText = s;
            },
            askCoach: async function() { const b = document.querySelector('button[onclick="gameManager.askCoach()"]'); b.disabled = true; let key = app.u().apiKey; 
                if(!key || key.length < 10) { app.showModal('Anahtar Eksik', 'BarÄ±ÅŸ Ã–ÄŸretmeninizden anahtarÄ± isteyin.', 'ğŸ”‘'); b.disabled = false; return; }
                try { const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: `SatranÃ§ koÃ§usun. FEN: "${this.game.fen()}". TÃ¼rkÃ§e kÄ±sa tavsiye ver.` }] }] }) }); const d = await r.json(); document.getElementById('coach-message').innerText = d.candidates[0].content.parts[0].text; document.getElementById('coach-modal').classList.remove('hidden'); } catch (e) { app.showModal('Hata', 'Anahtar geÃ§ersiz.', 'âŒ'); } finally { b.disabled = false; } },
            generateReport: async function(r) { app.closeModal(); app.showModal('Bekle...', 'Karne hazÄ±rlanÄ±yor', 'ğŸ“'); const key = app.u().apiKey; 
             if(!key || key.length < 10) { app.showModal('Anahtar Eksik', 'BarÄ±ÅŸ Ã–ÄŸretmeninizden anahtarÄ± isteyin.', 'ğŸ”‘'); return; }
            try { const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: `Ã–ÄŸrenci: ${app.currentUser}. SonuÃ§: ${r}. FEN: "${this.game.fen()}". Motive edici kÄ±sa karne yaz.` }] }] }) }); const d = await res.json(); app.showModal('Karne', d.candidates[0].content.parts[0].text, 'âœ¨'); } catch(e) {} }
        };

        const minigameManager = {
            icons: ['fa-chess-king', 'fa-chess-queen', 'fa-chess-rook', 'fa-chess-bishop', 'fa-chess-knight', 'fa-chess-pawn', 'fa-chess-board', 'fa-crown'],
            flippedCards: [], lockBoard: false, xoxState: Array(9).fill(null), xoxTurn: 'X', xoxMode: 'pvp', xoxActive: false,
            initMemory: function() { const g = document.getElementById('memory-grid'); g.innerHTML = ''; this.flippedCards = []; this.lockBoard = false; [...this.icons.slice(0, 8), ...this.icons.slice(0, 8)].sort(() => 0.5 - Math.random()).forEach(i => { const c = document.createElement('div'); c.className = 'memory-card h-20 cursor-pointer'; c.dataset.icon = i; c.onclick = () => this.flipCard(c); c.innerHTML = `<div class="memory-card-inner"><div class="memory-card-front bg-purple-600 rounded-lg flex items-center justify-center"><i class="fa-solid fa-question text-3xl opacity-50 text-white"></i></div><div class="memory-card-back bg-white border-2 border-purple-600 rounded-lg flex items-center justify-center"><i class="fa-solid ${i} text-3xl text-purple-800"></i></div></div>`; g.appendChild(c); }); },
            flipCard: function(c) { if (this.lockBoard || c === this.flippedCards[0]) return; c.classList.add('flipped'); this.flippedCards.push(c); if (this.flippedCards.length === 2) this.checkForMatch(); },
            checkForMatch: function() { this.lockBoard = true; const [c1, c2] = this.flippedCards; if (c1.dataset.icon === c2.dataset.icon) { this.flippedCards = []; this.lockBoard = false; app.addGold(5); audioManager.win(); if(document.querySelectorAll('.memory-card.flipped').length === 16) { setTimeout(() => { confetti({ particleCount: 100 }); app.addGold(20); app.showModal('Harika!', '+20 AltÄ±n', 'ğŸ§ '); }, 500); } } else { audioManager.error(); setTimeout(() => { c1.classList.remove('flipped'); c2.classList.remove('flipped'); this.flippedCards = []; this.lockBoard = false; }, 1000); } },
            initXox: function() { this.xoxState = Array(9).fill(null); this.xoxTurn = 'X'; this.xoxActive = true; this.renderXox(); },
            setXoxMode: function(m) { this.xoxMode = m; document.getElementById('xox-mode-pvp').className = m==='pvp'?"px-4 py-1 bg-blue-100 text-blue-700 rounded-md text-sm font-bold":"px-4 py-1 text-gray-500 rounded-md text-sm font-bold"; document.getElementById('xox-mode-ai').className = m==='ai'?"px-4 py-1 bg-blue-100 text-blue-700 rounded-md text-sm font-bold":"px-4 py-1 text-gray-500 rounded-md text-sm font-bold"; this.initXox(); },
            renderXox: function() { const g = document.getElementById('xox-grid'); g.innerHTML = ''; document.getElementById('xox-status').innerText = `SÄ±ra: ${this.xoxTurn}`; this.xoxState.forEach((v, i) => { const d = document.createElement('div'); d.className = 'xox-cell text-blue-600'; d.innerText = v || ''; if(!v && this.xoxActive) d.onclick = () => this.xoxMove(i); g.appendChild(d); }); },
            xoxMove: function(i) { if(!this.xoxActive || this.xoxState[i]) return; this.xoxState[i] = this.xoxTurn; this.renderXox(); if(this.checkXoxWin()) return; this.xoxTurn = this.xoxTurn === 'X' ? 'O' : 'X'; if(this.xoxMode === 'ai' && this.xoxTurn === 'O' && this.xoxActive) setTimeout(() => this.xoxAiMove(), 500); else this.renderXox(); },
            xoxAiMove: function() { const e = this.xoxState.map((v, i) => v === null ? i : null).filter(v => v !== null); if(e.length > 0) this.xoxMove(e[Math.floor(Math.random() * e.length)]); },
            checkXoxWin: function() { const w = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]; for(let c of w) { if(this.xoxState[c[0]] && this.xoxState[c[0]] === this.xoxState[c[1]] && this.xoxState[c[0]] === this.xoxState[c[2]]) { this.xoxActive = false; document.getElementById('xox-status').innerText = `Kazanan: ${this.xoxState[c[0]]}`; app.addGold(15); audioManager.win(); confetti({ particleCount: 50 }); return true; }} if(!this.xoxState.includes(null)) { this.xoxActive = false; document.getElementById('xox-status').innerText = "Berabere!"; return true; } return false; },
            
            initMath: function() {
                const pieces = { 'p': {v:1, i:'fa-chess-pawn'}, 'n': {v:3, i:'fa-chess-knight'}, 'b': {v:3, i:'fa-chess-bishop'}, 'r': {v:5, i:'fa-chess-rook'}, 'q': {v:9, i:'fa-chess-queen'} };
                const keys = Object.keys(pieces);
                let total = 0; let html = '';
                for(let i=0; i<3; i++) {
                    const p = pieces[keys[Math.floor(Math.random()*keys.length)]];
                    total += p.v;
                    html += `<i class="fa-solid ${p.i} text-blue-600"></i>${i<2?' + ':''}`;
                }
                document.getElementById('math-problem').innerHTML = html + ' = ?';
                const opts = document.getElementById('math-options'); opts.innerHTML = '';
                const answers = [total, total+1, total-1].sort(() => 0.5 - Math.random());
                answers.forEach(a => {
                    opts.innerHTML += `<button onclick="minigameManager.checkMath(${a}, ${total})" class="bg-gray-100 py-3 rounded-xl font-bold text-lg hover:bg-gray-200">${a}</button>`;
                });
            },
            checkMath: function(ans, correct) {
                if(ans === correct) { audioManager.win(); app.addGold(10); app.showModal('DoÄŸru!', '+10 AltÄ±n', 'ğŸ§®'); this.initMath(); }
                else { audioManager.error(); app.showModal('YanlÄ±ÅŸ', 'Tekrar dene!', 'âŒ'); }
            },
            checkColor: function(ans) {
                // e4 is white. Simple logic for now.
                if(ans === 'white') { audioManager.win(); app.addGold(10); app.showModal('DoÄŸru!', '+10 AltÄ±n', 'ğŸ¨'); }
                else { audioManager.error(); app.showModal('YanlÄ±ÅŸ', 'e4 karesi beyazdÄ±r.', 'âŒ'); }
            },
            generateStory: async function() { 
                const p = document.getElementById('story-prompt').value; if(!p) return; const o = document.getElementById('story-output'); o.innerHTML = '...'; 
                let key = app.u().apiKey;
                if(!key || key.length < 10) { o.innerText = "Anahtar eksik! BarÄ±ÅŸ Ã–ÄŸretmen'den isteyin."; return; }
                try { const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: `MasalcÄ± Nine: "${p}". TÃ¼rkÃ§e.` }] }] }) }); const d = await r.json(); o.innerHTML = marked.parse(d.candidates[0].content.parts[0].text); app.addGold(5); } catch(e) { o.innerText = "Hata."; } 
            },
            
            initQuiz: async function() {
                document.getElementById('view-minigame_quiz').classList.remove('hidden');
                document.getElementById('view-games_hub').classList.add('hidden');
                const qEl = document.getElementById('quiz-question'); const oEl = document.getElementById('quiz-options'); const fEl = document.getElementById('quiz-feedback');
                qEl.innerText = "Soru yÃ¼kleniyor..."; oEl.innerHTML = ''; fEl.classList.add('hidden');
                let key = app.u().apiKey;
                if(!key || key.length < 10) { qEl.innerText = "Anahtar eksik! BarÄ±ÅŸ Ã–ÄŸretmen'den isteyin."; return; }
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `Generate a multiple-choice chess question in Turkish JSON format: {question: string, options: string[], correctIndex: number}. Question should be suitable for kids.` }] }], generationConfig: { responseMimeType: "application/json" } })
                    });
                    const data = await response.json(); const quizData = JSON.parse(data.candidates[0].content.parts[0].text);
                    qEl.innerText = quizData.question;
                    quizData.options.forEach((opt, idx) => {
                        const btn = document.createElement('button'); btn.className = "w-full text-left p-3 bg-gray-100 rounded-lg hover:bg-gray-200 transition font-medium text-gray-700"; btn.innerText = opt; btn.onclick = () => this.checkQuiz(idx, quizData.correctIndex, fEl); oEl.appendChild(btn);
                    });
                } catch(e) { qEl.innerText = "BaÄŸlantÄ± hatasÄ±."; }
            },
            
            checkQuiz: function(selected, correct, fEl) {
                fEl.classList.remove('hidden');
                if(selected === correct) { fEl.innerHTML = '<span class="text-green-600 text-xl"><i class="fa-solid fa-check-circle"></i> DoÄŸru! +15 AltÄ±n</span>'; app.addGold(15); confetti({ particleCount: 100, origin: { y: 0.6 } }); audioManager.win(); } 
                else { fEl.innerHTML = '<span class="text-red-600 text-xl"><i class="fa-solid fa-circle-xmark"></i> YanlÄ±ÅŸ. Tekrar dene!</span>'; audioManager.error(); }
            }
        };

        const lessonManager = {
            board: null, currentLessonId: 'coban', currentStep: -1, game: new Chess(),
            lessons: { 'coban': { moves: ['e4', 'e5', 'Bc4', 'Nc6', 'Qh5', 'Nf6', 'Qxf7#'], texts: ["1. Beyaz piyon e4.", "Siyah e5.", "2. Fil c4.", "Siyah at.", "3. Vezir h5.", "Siyah gÃ¶rmedi!", "4. Ã‡OBAN MATI!"] }, 'aptal': { moves: ['f3', 'e5', 'g4', 'Qh4#'], texts: ["1. Beyaz f3.", "Siyah e5.", "2. Beyaz g4.", "3. APTAL MATI!"] }, 'merdiven': { setup: '8/8/8/8/8/4k3/R7/R3K3 w - - 0 1', moves: ['Ra3+', 'Kd4', 'Rb4+', 'Kc5', 'Ra5#'], texts: ["1. Kale ÅŸah.", "Åah kaÃ§ar.", "2. DiÄŸer kale.", "Åah sÄ±kÄ±ÅŸtÄ±.", "3. MERDÄ°VEN MATI!"] }, 'bogmaca': { setup: '6rk/5Npp/8/8/8/8/8/7K w - - 0 1', moves: ['Nh6+', 'Kh8', 'Qg8+', 'Rxg8', 'Nf7#'], texts: ["1. At ile ÅŸah!", "Åah kÃ¶ÅŸeye.", "2. Vezir fedasÄ±!", "Kale alÄ±r.", "3. BOÄMACA MATI!"] }, 'arka': { setup: '6k1/5ppp/8/8/8/8/1R6/1R4K1 w - - 0 1', moves: ['Rb8#'], texts: ["1. Kale aÅŸaÄŸÄ± iner.", "ÅahÄ±n Ã¶nÃ¼ kapalÄ±.", "ARKA YATAY MATI!"] } },
            init: function() { this.board = Chessboard('lesson-board', { draggable: false, pieceTheme: gameManager.getPieceTheme }); },
            loadLesson: function(id) { this.currentLessonId = id; this.currentStep = -1; this.game = new Chess(); if(this.lessons[id].setup) this.game.load(this.lessons[id].setup); else this.game.reset(); this.board.position(this.game.fen()); this.updateText(); },
            resize: function() { setTimeout(() => { if(this.board) this.board.resize(); }, 100); },
            next: function() { const l = this.lessons[this.currentLessonId]; if(this.currentStep < l.moves.length - 1) { this.currentStep++; this.game.move(l.moves[this.currentStep]); this.board.position(this.game.fen()); this.updateText(); if(this.currentStep === l.moves.length - 1) { confetti({ particleCount: 100, origin: { y: 0.6 } }); app.addGold(10); audioManager.win(); } } },
            prev: function() { if(this.currentStep >= 0) { this.currentStep--; this.game.undo(); this.board.position(this.game.fen()); this.updateText(); } },
            updateText: function() { document.getElementById('lesson-text').innerText = this.currentStep === -1 ? "BaÅŸla" : this.lessons[this.currentLessonId].texts[this.currentStep]; }
        };

        const marketManager = {
            filter: 'board',
            items: [ 
                { id: 'theme-wood', name: 'AhÅŸap', type: 'board', price: 100, color: '#deb887' }, 
                { id: 'theme-blue', name: 'Okyanus', type: 'board', price: 150, color: '#60a5fa' }, 
                { id: 'theme-green', name: 'Orman', type: 'board', price: 150, color: '#4ade80' }, 
                { id: 'piece-alpha', name: 'Alpha', type: 'pieces', price: 200, icon: 'fa-chess-king' }, 
                { id: 'piece-uscf', name: 'Retro', type: 'pieces', price: 200, icon: 'fa-chess-knight' }, 
                { id: 'avatar-king', name: 'Åah', type: 'avatar', price: 300, img: 'https://cdn-icons-png.flaticon.com/512/3039/3039396.png' }, 
                { id: 'avatar-queen', name: 'Vezir', type: 'avatar', price: 400, img: 'https://cdn-icons-png.flaticon.com/512/963/963728.png' },
                // SPECIAL ITEMS
                { id: 'avatar-princess', name: 'Prenses', type: 'special', price: 1000, img: 'https://cdn-icons-png.flaticon.com/512/2065/2065176.png' },
                { id: 'avatar-hero', name: 'SÃ¼per Kahraman', type: 'special', price: 1000, img: 'https://cdn-icons-png.flaticon.com/512/4043/4043191.png' },
                { id: 'avatar-unicorn', name: 'Unicorn', type: 'special', price: 1500, img: 'https://cdn-icons-png.flaticon.com/512/2396/2396920.png' },
                { id: 'avatar-robot-king', name: 'Robot Kral', type: 'special', price: 1500, img: 'https://cdn-icons-png.flaticon.com/512/4255/4255686.png' }
            ],
            setFilter: function(f) { this.filter = f; this.render(); },
            render: function() { 
                const c = document.getElementById('market-grid'); 
                if(!c) return; c.innerHTML = ''; 
                
                // Handle Tab Active States
                document.querySelectorAll('#view-market button[id^="tab-"]').forEach(b => { 
                    b.classList.remove('bg-blue-100', 'text-blue-600'); 
                    if(b.id === 'tab-'+this.filter) b.classList.add('bg-blue-100', 'text-blue-600'); 
                });

                if(this.filter === 'rank') {
                     c.innerHTML = `
                        <div class="col-span-2 bg-white p-4 rounded-xl text-center">
                            <h3 class="font-bold text-gray-800">RÃ¼tbe Sistemi</h3>
                            <p class="text-sm text-gray-500 mb-4">AltÄ±n kazanarak yÃ¼ksel!</p>
                            <div class="space-y-2 text-left text-sm">
                                <div class="flex justify-between"><span>Acemi</span> <span class="text-gray-400">0+ AltÄ±n</span></div>
                                <div class="flex justify-between"><span>Ã‡Ä±rak</span> <span class="text-green-500">100+ AltÄ±n</span></div>
                                <div class="flex justify-between"><span>Oyuncu</span> <span class="text-blue-500">300+ AltÄ±n</span></div>
                                <div class="flex justify-between"><span>Usta</span> <span class="text-purple-500">600+ AltÄ±n</span></div>
                                <div class="flex justify-between"><span>BÃ¼yÃ¼kusta</span> <span class="text-orange-500">1000+ AltÄ±n</span></div>
                                <div class="flex justify-between"><span>Efsane</span> <span class="text-red-500">2000+ AltÄ±n</span></div>
                            </div>
                        </div>`;
                     return;
                }

                this.items.filter(i => i.type === this.filter).forEach(item => { 
                    const owned = app.u().inventory.includes(item.id); 
                    let btn = app.u().equippedTheme === item.id || app.u().equippedPieceSet === item.id.replace('piece-','') || app.u().equippedAvatar === item.id ? `<button class="w-full bg-gray-100 text-gray-400 py-2 rounded-lg text-xs cursor-default">SeÃ§ili</button>` : owned ? `<button onclick="marketManager.equip('${item.id}', '${item.type}')" class="w-full bg-blue-100 text-blue-600 py-2 rounded-lg font-bold text-xs hover:bg-blue-200">Kullan</button>` : `<button onclick="marketManager.buy('${item.id}', ${item.price})" class="w-full bg-yellow-400 text-yellow-900 py-2 rounded-lg font-bold text-xs hover:bg-yellow-500 shadow">Al ${item.price}</button>`; 
                    let vis = '';
                    if(item.type === 'board') vis = `<div class="w-12 h-12 rounded-lg shadow-inner" style="background-color: ${item.color}"></div>`;
                    else if(item.type === 'pieces') vis = `<i class="fa-solid ${item.icon} text-4xl text-gray-700"></i>`;
                    else vis = `<img src="${item.img}" class="w-12 h-12 object-contain">`;
                    
                    c.innerHTML += `<div class="bg-white rounded-xl p-3 shadow-sm border border-gray-100 flex flex-col items-center gap-2">${vis}<span class="font-bold text-gray-700 text-sm">${item.name}</span>${btn}</div>`; 
                }); 
                this.applyTheme(); 
            },
            buy: function(id, price) { if(app.spendGold(price)) { app.u().inventory.push(id); app.saveGlobal(); this.render(); app.showModal('AldÄ±n!', 'HayÄ±rlÄ± olsun.', 'ğŸ›ï¸'); } else app.showModal('Yetersiz', 'Daha fazla oyna!', 'âš ï¸'); },
            equip: function(id, type) { 
                if(type === 'special') type = 'avatar'; // Special items are avatars
                if(type === 'board') app.u().equippedTheme = id; 
                if(type === 'pieces') app.u().equippedPieceSet = id.replace('piece-', ''); 
                if(type === 'avatar') app.u().equippedAvatar = id; 
                app.saveGlobal(); this.render(); 
                if(type === 'pieces') { document.getElementById('board').innerHTML = ''; setTimeout(() => gameManager.initBoard(), 50); } 
            },
            applyTheme: function() { const colors = { 'classic': ['#f0d9b5', '#b58863'], 'theme-wood': ['#E1C699', '#8B5A2B'], 'theme-blue': ['#E0F2FE', '#3B82F6'], 'theme-green': ['#DCFCE7', '#22C55E'] }[app.u().equippedTheme] || ['#f0d9b5', '#b58863']; let s = document.getElementById('board-theme-style'); if(!s) { s = document.createElement('style'); s.id = 'board-theme-style'; document.head.appendChild(s); } s.innerHTML = `.white-1e1d7 { background-color: ${colors[0]} !important; color: ${colors[1]} !important; } .black-3c85d { background-color: ${colors[1]} !important; color: ${colors[0]} !important; }`; }
        };

        window.addEventListener('DOMContentLoaded', () => { app.init(); gameManager.init(); lessonManager.init(); app.navTo('home'); });
    </script>
</body>
</html>


